<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <style>
            .raw{
                padding: 0;
                position: fixed;
                left: 0;
                top: 0;
            }
        </style>
    </head>
    <body>
        <canvas class="raw" id="canvas"></canvas>
        <p class="raw" style="font-size: 50px; color: white;" id="p"></p>
        <script>
            const /** @type {HTMLCanvasElement} */ canvas = document.getElementById(`canvas`);
            const ctx = canvas.getContext(`2d`);
            let val = 0;
            const /** @type {HTMLParagraphElement} */ p = document.getElementById(`p`);
            function render(){
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = `rgba(${Math.trunc(val * 255)}, ${Math.trunc(255 - val * 255)}, 0, 0.5)`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            function handler(/** @type {MessageEvent<*>} */ e){
                val = e.data.prog;
                // console.log('哈哈1号更新');
                render();
                p.innerText = JSON.stringify(e.data);
            }
            window.addEventListener(`message`, (e) => {
                handler(e);
            });
            function resize(){
                let res = canvas.width !== window.innerWidth || canvas.height !== window.innerHeight;
                if(res){
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                }
                return res;
            }
            function tick(){
                if(resize()){
                    render();
                }
                requestAnimationFrame(tick);
            }
            resize();
            handler({ data: { prog: 0 } });
            requestAnimationFrame(tick);
        </script>
    </body>
</html>