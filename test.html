<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
	<style>
		:root {
			color-scheme: dark;
			font-family: "Consolas", monospace;
		}
		.axis {
			position: absolute;
			inset: 0;
			margin: auto;
			background-color: #fff2;
		}
	</style>
</head>
<body>
	<p id="ts"></p>
	<div style="position: relative; inset: 0; width: 1000px; height: 600px;">
		<canvas id="canvas" width="1000" height="600"></canvas>
		<div class="axis" style="width: 100%; height: 2px;"></div>
		<div class="axis" style="width: 2px; height: 100%;"></div>
	</div>

	<script>
		const deg = Math.PI / 180;
		const /** @type {HTMLParagraphElement} */ ts = document.getElementById("ts");
		const /** @type {HTMLCanvasElement} */ canvas = document.getElementById("canvas");
		const ctx = canvas.getContext("2d");
		const /** @type {{ts: Date, spd: number, deg: number}[]} */ data = [];
		var t = 0;

		async function load() {
			const d = (await fetch("wind.csv").then((res) => res.text())).split("\n").slice(1);
			for (let s of d) {
				let s1 = s.split(",");
				data.push({
					ts: new Date(s1[0]),
					spd: Number.parseFloat(s1[1]),
					deg: Number.parseFloat(s1[2])
				});
			}
		}

		function render(/** @type {number} */ t) {
			const angl = data[t].deg * deg;
			const x = 500 + 20 * data[t].spd * Math.sin(angl);
			const y = 300 - 20 * data[t].spd * Math.cos(angl);
			ts.textContent = data[t].ts;
			ctx.fillStyle = "#00000004";
			ctx.fillRect(0, 0, 1000, 600);
			ctx.fillStyle = "#fff";
			ctx.fillRect(x - 1, y - 1, 2, 2);
		}

		function frame() {
			render(t++);
			render(t++);
			requestAnimationFrame(frame);
		}

		ctx.fillStyle = "#000";
		ctx.fillRect(0, 0, 1000, 600);
		load().then(frame);
	</script>
</body>
</html>